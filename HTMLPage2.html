<!DOCTYPE html>
<html>
<head>
  <title>Playlist Artists</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Playlist Artists</h1>
  <h2>Enter Playlist ID:</h2>
  <input type="text" id="playlistIdInput">
  <button onclick="getPlaylistArtists()">Get Artists</button>
  <div id="chartContainer" style="max-width: 600px; margin-top: 20px;">
    <canvas id="artistsChart"></canvas>
  </div>
  <script>
    var url = window.location.href;
    var accessToken = url.match(/\#(?:access_token)\=([\S\s]*?)\&/)[1]; // Set your Spotify API access token here

    function getPlaylistArtists() {
      var playlistId = document.getElementById("playlistIdInput").value;
      var artistsListElement = document.getElementById("artistsList");
      artistsListElement.innerHTML = ""; // Clear existing list

      var artistsData = {}; // Object to store artist names and their counts

      // Function to fetch playlist tracks from URL
      function fetchPlaylistTracks(url) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", url);
        xhr.setRequestHeader("Authorization", "Bearer " + access_token);
        xhr.onload = function () {
          if (xhr.status === 200) {
            var json = JSON.parse(xhr.responseText);
            var items = json.items;
            for (var i = 0; i < items.length; i++) {
              var artists = items[i].track.artists;
              for (var j = 0; j < artists.length; j++) {
                var artistName = artists[j].name;
                if (artistsData[artistName]) {
                  artistsData[artistName]++; // Increment count if artist already exists
                } else {
                  artistsData[artistName] = 1; // Add artist with count 1 if doesn't exist
                }
              }
            }
            var nextUrl = json.next;
            if (nextUrl) {
              fetchPlaylistTracks(nextUrl); // Fetch next page of tracks recursively
            } else {
              // Render chart when all tracks fetched
              renderChart(Object.keys(artistsData), Object.values(artistsData));
            }
          } else {
            console.error("Failed to fetch playlist tracks: ", xhr.status);
          }
        };
        xhr.send();
      }

      // Call fetchPlaylistTracks with initial URL
      var initialUrl = "https://api.spotify.com/v1/playlists/" + playlistId + "/tracks";
      fetchPlaylistTracks(initialUrl);
    }

    // Function to render bar chart
    function renderChart(labels, data) {
      var ctx = document.getElementById("artistsChart").getContext("2d");
      var chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [{
            label: "Artist Counts",
            data: data,
            backgroundColor: "rgba(75, 192, 192, 0.2)",
            borderColor: "rgba(75, 192, 192, 1)",
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              stepSize: 1
            }
          }
        }
      });
    }
  </script>
</body>
</html>
